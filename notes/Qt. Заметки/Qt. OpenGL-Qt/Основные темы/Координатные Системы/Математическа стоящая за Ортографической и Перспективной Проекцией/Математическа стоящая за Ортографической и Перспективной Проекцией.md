---


---
---
##### Данная заметка перевод - этой (добавить линк) статьи.
---

## Общее представление

Компьюторный монитор - это 2D поверхность. Так как OpenGL может представлять собой сцену 3D, то соответсвенно эта 3D пространство должно проецироваться на 2D поверхность компьютерного экрана.

Для данного преобразования используются специальные матрицы трансформации. В OpenGL есть тип для них - `GL_PROJECTION`. Они считаются частью пайплайна [трансформации](obsidian://open?vault=general&file=Notion%2FQt.%20%D0%97%D0%B0%D0%BC%D0%B5%D1%82%D0%BA%D0%B8%2FQt.%20OpenGL-Qt%2F%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D1%8B%D0%B5%20%D1%82%D0%B5%D0%BC%D1%8B%2F%D0%A2%D1%80%D0%B0%D0%BD%D1%81%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8%2F%D0%A2%D1%80%D0%B0%D0%BD%D1%81%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D0%B8).

Основная цель данной проекции трансформация всех Вершинных Координат из _**Пространства Координат Наблюдателя**_ в _**Пространство Координат Отсечения**_. В дальнейшем _**Пространство Координат Отсечения**_ также трансформируются в _Нормализованные Координаты Устройства_ (_NDC_), при этой операции происходит деление всех компонент на компоненту $w$﻿.

Стоит понимать, что и _отсечение_ (отбор усеченных участков пирамиды) и _NDC_ трансформации напрямую интергрированы в `GL_PROJECTION` матрицу. Дальнейшие параграфы будут описывать, как создать такую матрицу самостоятельно используя только

6 основных параметров - левые, правые, нижние, верхние, ближние и дальние значения границ.

Так же стоит помнить, что _отбор усеченных участков пирамиды_ (_отсечение_) производится в _**Кординатах Отсечения**_ (они обычно, как мы наблюдали в прошлой статье, используются от $-1000.0$﻿ до $1000.0$﻿), как раз таки перед тем, как разделить все компоненты на $w_c$﻿. Так же у _**Кординатах Отсечения**_ производится сравнение всех компонент $\textcolor{#FF3333}{x_с}, \textcolor{#4D9900}{y_с}, \textcolor{#4287FF}{z_с}$﻿ c компонентой $w_c$﻿. Если любая из этих компонент меньше чем $-w_c$﻿, либо же больше чем $w_c$﻿ то вершина будет отброшена.

То есть формально ограничение выглядит так: $-w_c < (\textcolor{#FF3333}{x_с}, \textcolor{#4D9900}{y_с}, \textcolor{#4287FF}{z_с}) < w_c$﻿

![[general_picture_perspective_clipping.svg]]

Затем OpenGL восстановит края многоугольника, по которым происходит отсечение.

## Проекция Перспективы

![[perspective_fustrum_and_ndc.svg]]

_Усеченная Пирамида_ и _Нормализованные Координаты Устройства_

В Проекции Перспективы 3D точка (в _**Координатах Наблюдателя**_) Усеченной Пирамиды (Слева на картинке) будет отображена на куб _NDC_ (Справа на картинке).

- Диапазон координат по $\textcolor{#ff3333}{X}$﻿ приведется от $[\textcolor{#ff3333}{l},\textcolor{#ff3333}{r}]$﻿ к $[\textcolor{#ff3333}{-1},\textcolor{#ff3333}{1}]$﻿.
- Диапазон координат по $\textcolor{#4D9900}{Y}$﻿ приведется от $[\textcolor{#4D9900}{b},\textcolor{#4D9900}{t}]$﻿ к $[\textcolor{#4D9900}{-1},\textcolor{#4D9900}{1}]$﻿.
- Диапазон координат по $\textcolor{#4287FF}{Z}$﻿ приведется от $[\textcolor{#4287FF}{-n},\textcolor{#4287FF}{-f}]$﻿ к $[\textcolor{#4287FF}{-1},\textcolor{#4287FF}{1}]$﻿.

$$\textcolor{#ff3333}{l}eft,\ \textcolor{#ff3333}{r}ight,\ \textcolor{\#4D9900}{b}ottom, \ \textcolor{#4D9900}{t}op,\ \textcolor{\#4287FF}{n}ear,\ \textcolor{#4287FF}{f}ar$$

Стоит так же обратить внимание, что в _**Координатах Наблюдателя**_ определены в правосторонней системе координат, при этом _Нормализованные Координаты Устройства_ используют левосторонюю систему координат. Другими словами, в Координатах Наблюдателя камера смотрит от точки отсчета по оси $\textcolor{#4287FF}{-Z}$﻿, а в NDC камера смотриn по $\textcolor{#4287FF}{+Z}$﻿.

Так как функция `glFrustum()` принимает только позитивные значения расстояний $\textcolor{#4287FF}{n}ear$﻿ и $\textcolor{#4287FF}{f}ar$﻿, нам придется сначала инверснуть их, во время создания `GL_PROJECTION` матрицы.

В OpenGL точка в 3D в _**Координатах Наблюдателя**_ будет проецироваться на Ближнюю Плоскость ($\textcolor{#4287FF}{n}ear$﻿)
### Проекция 3D точки в Усеченной Пирамиде, вид сверху

Представим нашу задачу следующим образом:  
Мы имеем точку $(\textcolor{#FF3333}{x_e}, \textcolor{#4D9900}{y_e}, \textcolor{#4287FF}{z_e})$﻿ и мы хотим спроецировать на _ближайшую плоскость_ ($\textcolor{#4287FF}{n}ear$﻿) _Усеченной Пирамиды_, ровно так OpenGL и проецирует 3D точки из _**Пространства Наблюдателя**_. Для этого из точки $(\textcolor{#FF3333}{x_e}, \textcolor{#4D9900}{y_e}, \textcolor{#4287FF}{z_e})$﻿ проведем прямую линию к центру координат $(\textcolor{#FF3333}{0}, \textcolor{#4D9900}{0}, \textcolor{#4287FF}{0})$﻿. Точку пересечения этой линии с _ближайшую плоскость_ ($\textcolor{#4287FF}{n}ear$﻿) обозначим как $(\textcolor{#FF3333}{x_p}, \textcolor{#4D9900}{y_p}, \textcolor{#4287FF}{z_p})$﻿ и именно её-то нам и надо будет найти!

![[projection_frustrum_top_view_1.svg]]

Начнем с самого простого, с точки $\textcolor{#4287FF}{z_p}$﻿ - она просто будет равна $\textcolor{#4287FF}{-n}$﻿, и в дальнейшем пользователь задаст это значение руками.

Точку $\textcolor{#4D9900}{y_p}$﻿ мы найдем, когда будем рассматривать Усеченную Пирамиду сбоку, поэтому пока просто можем записать что компонента $\textcolor{#4D9900}{y_e}$﻿ спроецирована в компоненту $\textcolor{#4D9900}{y_p}$﻿.

А вот для того, что бы найти компоненту $\textcolor{#FF3333}{x_p}$﻿ обратим внимание, что у нас есть два подобных треугольника: $\textcolor{\#4287FF}{A}\textcolor{#4287FF}{B}\textcolor{#FF3333}{C}$﻿ и $\textcolor{#4287FF}{A}\textcolor{#4287FF}{D}\textcolor{#FF3333}{E}$﻿, так как по факту $\textcolor{#FF3333}{x_p}\ =\ \textcolor{#4287FF}{D}\textcolor{#FF3333}{E}$﻿, его и высчитаем через соотношение сторон подобных треугольников.

![[projection_frustrum_top_view_2.svg]]

Формула, что бы освяжить в памяти:

![[ratio_of_similar_triangles.svg]]

$$\textcolor{#4287FF}{\frac{AD}{AB}}\ =\ \frac{\textcolor{#FF3333}{E}\textcolor{#4287FF}{D}}{\textcolor{#FF3333}{C}\textcolor{#4287FF}{B}}\ =\ \frac{\textcolor{#4287FF}{A}\textcolor{#FF3333}{E}}{\textcolor{#4287FF}{A}\textcolor{#FF3333}{C}}$$

Соответственно, нам нужно только вот эта часть:

$$\textcolor{#4287FF}{\frac{AD}{AB}}\ =\ \frac{\textcolor{#4287FF}{A}\textcolor{#FF3333}{E}}{\textcolor{#4287FF}{A}\textcolor{#FF3333}{C}}$$

Заменим буквенное представление треугольников на координатное:

$$\textcolor{#4287FF}{\frac{-n}{z_e}}\ =\ \frac{\textcolor{#FF3333}{x_p}}{\textcolor{#FF3333}{x_e}}$$

И теперь просто получим искомый $\textcolor{\#FF3333}{x_p}$﻿ из данного соотношения:

$$\textcolor{#FF3333}{x_p}\ =\ \frac{\textcolor{#4287FF}{-n} \cdot \textcolor{#FF3333}{x_e}}{\textcolor{#4287FF}{z_e}} \ = \ \frac{\textcolor{#4287FF}{n} \cdot \textcolor{#FF3333}{x_e}}{\textcolor{#4287FF}{-z_e}}$$

### Проекция 3D точки в Усеченной Пирамиде, вид сбоку

Задача переж нами будет стоять ровно такая же, как и в прошлом пункте, только теперь мы будет рассмматривать мапинг точек не в $\textcolor{#FF3333}{X}, \textcolor{#4287FF}{Z}$﻿ а в $\textcolor{#4D9900}{Y}, \textcolor{#4287FF}{Z}$﻿.
![[projection_frustrum_side_view_1.drawio.svg]]

Точки $\textcolor{#4287FF}{z_p}$﻿ - так же будет равна $\textcolor{#4287FF}{-n}$﻿.

Точку $\textcolor{#FF3333}{x_p}$﻿ мы нашли ранее, и тперь знаем, что $\textcolor{#FF3333}{x_p}\ = \ \frac{\textcolor{#4287FF}{n} \cdot \textcolor{#FF3333}{x_e}}{\textcolor{#4287FF}{-z_e}}$﻿

Точку $\textcolor{#4D9900}{y_p}$﻿ мы найдем по тому же принципу, как сделали это ранее. Первым делом обозначим подобные треугольники:

  

![[projection_frustrum_side_view_2.drawio.svg]]

Формула для подобных треугольников

![[ratio_of_similar_triangles_side_view.svg]]

$$\textcolor{#4287FF}{\frac{AD}{AB}}\ =\ \frac{\textcolor{#4D9900}{E}\textcolor{#4287FF}{D}}{\textcolor{#4D9900}{C}\textcolor{#4287FF}{B}}\ =\ \frac{\textcolor{#4287FF}{A}\textcolor{#4D9900}{E}}{\textcolor{#4287FF}{A}\textcolor{#4D9900}{C}}$$

Выписываем нужную часть:

$$\textcolor{#4287FF}{\frac{AD}{AB}}\ =\ \frac{\textcolor{#4287FF}{A}\textcolor{#4D9900}{E}}{\textcolor{#4287FF}{A}\textcolor{#4D9900}{C}}$$

Заменим буквенное представление треугольников на координатное:

$$\textcolor{#4287FF}{\frac{-n}{z_e}}\ =\ \frac{\textcolor{#4D9900}{y_p}}{\textcolor{#4D9900}{y_e}}$$

И теперь просто получим искомый $\textcolor{#4D9900}{y_p}$﻿ из данного соотношения:

$$\textcolor{#4D9900}{y_p}\ =\ \frac{\textcolor{#4287FF}{-n} \cdot \textcolor{#4D9900}{y_e}}{\textcolor{#4287FF}{z_e}} \ = \ \frac{\textcolor{#4287FF}{n} \cdot \textcolor{#4D9900}{y_e}}{\textcolor{#4287FF}{-z_e}}$$

### Результат проецирования

Итак, для того что бы спроецировать точку $(\textcolor{#FF3333}{x_e}, \textcolor{#4D9900}{y_e}, \textcolor{#4287FF}{z_e})$﻿ на $(\textcolor{#FF3333}{x_p}, \textcolor{#4D9900}{y_p}, \textcolor{#4287FF}{z_p})$﻿, которая находится на _ближайшую плоскости_ ($\textcolor{#4287FF}{n}ear$﻿), можно использовать следующее компонентное соотношение:
$$
(\textcolor{#FF3333}{x_p}, \textcolor{#4D9900}{y_p}, \textcolor{#4287FF}{z_p}) \ =\ (\frac{\textcolor{#4287FF}{n} \cdot \textcolor{#FF3333}{x_e}}{\textcolor{#4287FF}{-z_e}}, \frac{\textcolor{#4287FF}{n} \cdot \textcolor{#4D9900}{y_e}}{\textcolor{#4287FF}{-z_e}}, \textcolor{#4287FF}{-n})
$$
Обратим так же внимание, что и компонента $\textcolor{#FF3333}{x_p}$﻿ и $\textcolor{#4D9900}{y_p}$﻿ зависят от $\textcolor{#4287FF}{z_e}$﻿ - зависимость определяется как обратно-пропорциональная к $\textcolor{#4287FF}{-z_e}$﻿.

Таким образом - первый шаг _Проекционной Трансформации_ завершен.
### Трансформация из Пространства Наблюдателя в NDC.

В прошлом параграфе мы обратили внимание, что и $\textcolor{#FF3333}{x_p}$﻿ и $\textcolor{#4D9900}{y_p}$﻿ зависят обратно-пропорционально от $\textcolor{#4287FF}{-z_e}$﻿ - это и есть первая подсказка, как нам построить `GL_PROJECTION` матрицу.

После того как _**Координаты Наблюдателя**_ были трансформированы при помощи умножения на `GL_PROJECTION` матрицу, _**Координаты Отсечения**_ все еще остались в [[Гомогенные Координаты]]. Что бы в конечном итоге получить _Нормализованные Координаты Устройства_ (_NDC_), нужно разделить первые три компоненты _**Координаты Отсечения**_ на компоненту $w$﻿.

Больше деталей по этому преобразованию тут(Добавить ссылку).

Переход от _**Координаты Наблюдателя**_ к _**Координатом Отсечения**__:

$$
\begin{pmatrix} \textcolor{#FF3333}{x_{clip}} \\ \textcolor{#4D9900}{y_{clip}} \\ \textcolor{#4287FF}{z_{clip}} \\ w_{clip} \\ \end{pmatrix} \ =\ M_{projection} \cdot \begin{pmatrix} \textcolor{#FF3333}{x_{eye}} \\ \textcolor{#4D9900}{y_{eye}} \\ \textcolor{#4287FF}{z_{eye}} \\ w_{eye} \\ \end{pmatrix}
$$

Глобально переход от _**Координат Отсечения**_ к _NDC_ будет выглядеть так:

$$
\begin{pmatrix} \textcolor{#FF3333}{x_{ndc}} \\ \textcolor{#4D9900}{y_{ndc}} \\ \textcolor{#4287FF}{z_{ndc}} \\ \end{pmatrix} \ =\ \begin{pmatrix} \frac{\textcolor{#FF3333}{x_{clip}}}{w_{clip}} \\ \frac{\textcolor{#4D9900}{y_{clip}}}{w_{clip}} \\ \frac{\textcolor{#4287FF}{z_{clip}}}{w_{clip}} \\ \end{pmatrix}
$$
Держа в голове то, что нам надо получить в итоге, все-таки найдем _**Матрицу Проекций**_:

$$
\begin{pmatrix} \textcolor{#FF3333}{x_{c}} \\ \textcolor{#4D9900}{y_{c}} \\ \textcolor{#4287FF}{z_{c}} \\ w_{c} \\ \end{pmatrix} \ =\ X \cdot \begin{pmatrix} \textcolor{#FF3333}{x_{e}} \\ \textcolor{#4D9900}{y_{e}} \\ \textcolor{#4287FF}{z_{e}} \\ w_{e} \\ \end{pmatrix}
$$

Помня про ранее найденную зависимость координаты $\textcolor{#FF3333}{x_p}$﻿ и $\textcolor{#4D9900}{y_p}$﻿ от $\textcolor{#4287FF}{-z_e}$﻿ - зададим компоненту $w_{clip}$﻿ Пространства Отсечения, как $\textcolor{#4287FF}{-z_e}$﻿ и тогда 4-ый ряд _**Матрицы Проеции**_ будет равен $(0, 0, -1, 0)$﻿.

$$
\begin{pmatrix} \textcolor{#FF3333}{x_{c}} \\ \textcolor{#4D9900}{y_{c}} \\ \textcolor{#4287FF}{z_{c}} \\ w_{c} \\ \end{pmatrix} \ =\ \begin{pmatrix} \cdot & \cdot & \cdot & \cdot \\ \cdot & \cdot & \cdot & \cdot \\ \cdot & \cdot & \cdot & \cdot \\ 0 & 0 & -1 & 0 \\ \end{pmatrix} \begin{pmatrix} \textcolor{#FF3333}{x_{e}} \\ \textcolor{#4D9900}{y_{e}} \\ \textcolor{#4287FF}{z_{e}} \\ w_{e} \\ \end{pmatrix},\ \therefore w_c\ =\ \textcolor{#4287FF}{-z_{e}}
$$

Следующим шагом, мы должны отобразить $\textcolor{#FF3333}{x_p}$﻿ и $\textcolor{#4D9900}{y_p}$﻿ на $\textcolor{#FF3333}{x_n}$﻿ и $\textcolor{#4D9900}{y_n}$﻿ в координатах _NDC_. В этом нам поможет линейная зависимость: $[\textcolor{#ff3333}{l},\textcolor{#ff3333}{r}]$﻿ к $[\textcolor{#ff3333}{-1},\textcolor{#ff3333}{1}]$﻿ и $[\textcolor{#4D9900}{b},\textcolor{#4D9900}{t}]$﻿ к $[\textcolor{#4D9900}{-1},\textcolor{#4D9900}{1}]$﻿ (см. картинку в начале).

1. $[\textcolor{#ff3333}{l},\textcolor{#ff3333}{r}]$﻿ к $[\textcolor{#ff3333}{-1},\textcolor{#ff3333}{1}]$﻿
    
    ![[mapping_xp_xn.svg]]
    
    Проецирование точки $\textcolor{#FF3333}{x_p}$﻿ на $\textcolor{#FF3333}{x_n}$﻿.
    
    Для того что бы понять куда будет происходить проецирование, вспомним самую базовую формулу из Алгебры - формулу линейной зависимости 2-х точек:    $$\textcolor{#4D9900}{y} \ =\ m \cdot \textcolor{#FF3333}{x}\ +\ \beta$$Где $\beta$﻿ - координата пересечения ($x = 0$﻿) с осью $\textcolor{#4D9900}{y}$﻿, при линейной зависимости пересечение может случиться лишь раз.
    
    И $m$﻿ - угол наклона (slope), который показывает насколько сильно прямая наклонена относительно $\textcolor{#FF3333}{x}$﻿. Угол наклона высчитывается так:
    
    $$
    \text{m} \ =\ \dfrac{\text{изменение по }\textcolor{#4D9900}{y}}{\text{изменение по }\textcolor{#FF3333}{x}} \ =\ \dfrac{\textcolor{#4D9900}{y_2}-\textcolor{#4D9900}{y_1}}{\textcolor{#FF3333}{x_2}-\textcolor{#FF3333}{x_1}}
    $$
    
    Перепишем нашу проекцию от точки $\textcolor{#FF3333}{x_p}$﻿ на $\textcolor{#FF3333}{x_n}$﻿ как линейную зависимость:
    
    $$
    \begin{equation} \textcolor{#FF3333}{x_n} \ =\ \frac{\textcolor{#FF3333}{1} - (-\textcolor{#FF3333}{1})}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#FF3333}{x_p}\ +\ \beta \end{equation}
    $$
    
    Произведем замену точки $(\textcolor{#FF3333}{x_p}, \textcolor{#FF3333}{x_n})$﻿ на конкретную точку $(\textcolor{#FF3333}{r}, \textcolor{#FF3333}{1})$﻿ для дальнейшего выражения $\beta$﻿.
    
    $$
    \textcolor{#FF3333}{1} \ =\ \frac{\textcolor{#FF3333}{1} - (-\textcolor{#FF3333}{1})}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#FF3333}{r}\ +\ \beta
    $$
    
    Выразим $\beta$﻿:
	$$
	  
\beta \ =\ \textcolor{#FF3333}{1} -\frac{\textcolor{#FF3333}{1} - (-\textcolor{#FF3333}{1})}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#FF3333}{r} 
$$$$\ =\
\textcolor{#FF3333}{1} - \frac{2 \cdot \textcolor{#FF3333}{r}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ = \frac{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} - \frac{2 \cdot \textcolor{#FF3333}{r}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ =\newline 
$$
$$
\frac{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} - 2 \cdot \textcolor{#FF3333}{r}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ =\ \frac{-\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ 
=\newline $$
$$-\frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}$$
	
	Результат выражения: $\beta = \frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}$ подставим в уравнение $(1)$.
	$$\therefore \textcolor{#FF3333}{x_n} \ =\ \frac{2\cdot \textcolor{#FF3333}{x_p}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ -\ \frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}
	$$
    Теперь мы нашли $\textcolor{\#4D9900}{y_n}$﻿ и $\textcolor{\#FF3333}{x_n}$﻿, но что в одном, что в другом уравнении сейчас сохраняется зависимость от $\textcolor{#4D9900}{y_p}$﻿ и $\textcolor{#FF3333}{x_p}$﻿, а мы бы хотели что бы зависимость была только от компонент,



2. $[\textcolor{#4D9900}{b},\textcolor{#4D9900}{t}]$ к $[\textcolor{#4D9900}{-1},\textcolor{#4D9900}{1}]$​
	![[mapping_yp_yn 1.svg]]
	Проецирование точки $\textcolor{#4D9900}{y_p}$ на $\textcolor{#4D9900}{y_n}$.
	Перепишем нашу проекцию от точки $\textcolor{#4D9900}{y_p}$ на $\textcolor{#4D9900}{y_n}$ как линейную зависимость:
$$
\begin{equation} \textcolor{#4D9900}{y_n} \ =\ \frac{\textcolor{#4D9900}{1} - (-\textcolor{#4D9900}{1})}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \cdot \textcolor{#4D9900}{y_p}\ +\ \beta \end{equation}
$$
	Произведем замену точки $(\textcolor{#4D9900}{y_p}, \textcolor{#4D9900}{y_n})$ на конкретную точку $(\textcolor{#4D9900}{t}, \textcolor{#4D9900}{1})$ для дальнейшего выражения $\beta$.
$$
\textcolor{#4D9900}{1} \ =\ \frac{\textcolor{#4D9900}{1} - (-\textcolor{#4D9900}{1})}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \cdot \textcolor{#4D9900}{r}\ +\ \beta
$$
	Выразим $\beta$:
$$
\beta \ =\ \textcolor{#4D9900}{1} -\frac{\textcolor{#4D9900}{1} - (-\textcolor{#4D9900}{1})}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \cdot \textcolor{#4D9900}{t} \
= 
$$
$$
= \textcolor{#4D9900}{1} - \frac{2 \cdot \textcolor{#4D9900}{t}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ = \frac{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} - \frac{2 \cdot \textcolor{#4D9900}{t}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} = 
$$
$$
=
\frac{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} - 2 \cdot \textcolor{#4D9900}{t}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ =\ \frac{-\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ 
=
$$ 
$$
= - \frac{\textcolor{#4D9900}{t} + \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}
$$
	Результат выражения: $\beta = \frac{\textcolor{#4D9900}{t} + \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}$ подставим в уравнение $(2)$.
	
Теперь мы нашли $\textcolor{#4D9900}{y_n}$ и $\textcolor{#FF3333}{x_n}$, но что в одном, что в другом уравнении сейчас сохраняется зависимость от $\textcolor{#4D9900}{y_p}$ и $\textcolor{#FF3333}{x_p}$, а мы бы хотели что бы зависимость была только от компонент,
$\textcolor{#FF3333}{x_e}, \ \textcolor{#4D9900}{y_e}, \textcolor{#4287FF}{-z_e}$. Благо мы это можем организовать, так как ранее находили чему равно $\textcolor{#4D9900}{y_p}$ и $\textcolor{#FF3333}{x_p}$ через $\textcolor{#FF3333}{x_e}, \ \textcolor{#4D9900}{y_e}$ и $\textcolor{#4287FF}{-z_e}$.

1. Произведем подстановку $\textcolor{#FF3333}{x_p} \ = \ \frac{\textcolor{#4287FF}{n} \cdot \textcolor{#FF3333}{x_e}}{\textcolor{#4287FF}{-z_e}}$﻿ в тождество $\textcolor{#FF3333}{x_n}$﻿.
	$$
	\textcolor{#FF3333}{x_n} \ =\ \frac{2\cdot \frac{\textcolor{#4287FF}{n} \cdot \textcolor{#FF3333}{x_e}}{\textcolor{#4287FF}{-z_e}}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ -\ \frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ =\
	$$
    $$
    \ =\ \frac{2\cdot \textcolor{#4287FF}{n} \cdot \textcolor{#FF3333}{x_e}}{\textcolor{#4287FF}{-z_e}} \cdot \frac{1}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ -\ \frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ =\
    $$
    $$
    \ =\ \frac{ \frac{2\cdot \textcolor{#4287FF}{n}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#FF3333}{x_e}} {\textcolor{#4287FF}{-z_e}} \ +\ \frac{\frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#4287FF}{z_e}}{\textcolor{#4287FF}{-z_e}} \ =\
    $$
    $$
    \ =\ \Big( \underbrace{ \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } \cdot \textcolor{#FF3333}{x_e} \ +\ \frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } \cdot \textcolor{#4287FF}{z_e} }_{\textcolor{#FF3333}{x_c}} \Big) \ \Big/\ \textcolor{#4287FF}{-z_e}
    $$
2. Произведем подстановку $\textcolor{#4D9900}{y_p} \ = \ \frac{\textcolor{#4287FF}{n} \cdot \textcolor{#4D9900}{y_e}}{\textcolor{#4287FF}{-z_e}}$﻿ в тождество $\textcolor{#4D9900}{y_n}$﻿.
	$$
	\textcolor{#4D9900}{y_n} \ =\ \frac{2\cdot \ \frac{ \textcolor{#4287FF}{n} \cdot \textcolor{#4D9900}{y_e} }{ \textcolor{#4287FF}{-z_e} } }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \ -\ \frac{\textcolor{#4D9900}{t} + \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ =\
	$$
	$$
	\ =\ \frac{ 2\cdot \textcolor{#4287FF}{n} \cdot \textcolor{#4D9900}{y_e} }{ \textcolor{#4287FF}{-z_e} } \cdot \frac{1}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ -\ \frac{\textcolor{#4D9900}{t} + \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ =\
	$$
	$$
	\ =\ \frac{ \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \cdot \textcolor{#4D9900}{y_e}} { \textcolor{#4287FF}{-z_e} } \ +\ \frac{ \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \cdot \textcolor{#4287FF}{z_e} }{ \textcolor{#4287FF}{-z_e} } \ =\
	$$
	$$
	\ =\ \Big( \underbrace{ \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \cdot \textcolor{#4D9900}{y_e} \ +\ \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \cdot \textcolor{#4287FF}{z_e} }_{\textcolor{#4D9900}{y_c}} \Big) \ \Big/\ \textcolor{#4287FF}{-z_e}
	$$
    Так же следует обратить внимание, что в первом, что во втором случае и $\textcolor{#FF3333}{x_n}$﻿ и $\textcolor{#4D9900}{y_n}$﻿ оба приведены к одинаковому виду, где числитель разбит на компонентное сложения (буквально кусок операции перемножения компонент матриц), а знаменатель делится на $\textcolor{#4287FF}{-z_e}$﻿, что бы в дальнейшем было проще показать переход к _Делению Перспективы_ $( \frac{\textcolor{#FF3333}{x_с}}{w_c}, \frac{\textcolor{#4D9900}{y_с}}{w_c}, \frac{\textcolor{#4287FF}{z_с}}{w_c})$﻿.
    В формулах выше распишем чуть более широко разбивку по компонентам:
    $$
    \textcolor{#FF3333}{x_c} \ = \ \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } \cdot \textcolor{#FF3333}{x_e} \ +\ 0\ \cdot \ \textcolor{#4D9900}{y_e} \ +\ \frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } \cdot \textcolor{#4287FF}{z_e} \ +\ 0\ \cdot \ w_e
    $$
    
    $$
    \textcolor{#4D9900}{y_c} \ = \ 0 \cdot \textcolor{#FF3333}{x_e} \ +\ \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \ \cdot \ \textcolor{#4D9900}{y_e} \ +\ \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \cdot \textcolor{#4287FF}{z_e} \ +\ 0\ \cdot \ w_e
    $$
    
    И просто подставим получившиеся выражения в _Матрицу Проекций_, как первый и второй ряд:
    $$
    \begin{pmatrix} \textcolor{#FF3333}{x_{c}} \\ \textcolor{#4D9900}{y_{c}} \\ \textcolor{#4287FF}{z_{c}} \\ w_{c} \\ \end{pmatrix} \ =\ \begin{pmatrix} \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 & \frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 \\ 0 & \frac { 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & 0 \\ \cdot & \cdot & \cdot & \cdot \\ 0 & 0 & -1 & 0 \\ \end{pmatrix} \begin{pmatrix} \textcolor{#FF3333}{x_{e}} \\ \textcolor{#4D9900}{y_{e}} \\ \textcolor{#4287FF}{z_{e}} \\ w_{e} \\ \end{pmatrix}
    $$
    И теперь остается только заполнить 3-й ряд, что бы _Матрицу Проекций_ была полностью готова.
    
    Нахождение компоненты $\textcolor{#4287FF}{z_n}$﻿ будет немного отличаться в плане алгоритма нахождения, в отличии от ранее найденных компонент. Отличия будут, так как компонента $\textcolor{#4287FF}{z_e}$﻿ Пространства Наблюдателя всегда проецируется на $\textcolor{#4287FF}{-n}$﻿ ближайшей плоскости _Усеченного Конуса_, при этом нам нужны будут уникальные значения по $\textcolor{#4287FF}{z}$﻿ для дальнейшего _Отсечения_ и _Теста Глубины_ (_depth test_). Ну и также уникальность значений позволит откатить трансформацию в состояние “до” (_инверсная трансформация_).
    
    Мы знаем что ось $\textcolor{\#4287FF}{z}$﻿ не зависит ни от $\textcolor{#FF3333}{x}$﻿, ни от $\textcolor{#4D9900}{y}$﻿ - нам становятся интересны только компоненты по $\textcolor{#4287FF}{z}$﻿ и по $w$﻿, все остальные мы можем занулить, так же для нахождение зависимости от $\textcolor{#4287FF}{z_n}$﻿ к $\textcolor{#4287FF}{z_e}$﻿ пока что обозначим неизвестные компоненты как $\textcolor{#4287FF}{A}$﻿ и $B$﻿.
    
    $$
    \begin{pmatrix} \textcolor{#FF3333}{x_{c}} \\ \textcolor{#4D9900}{y_{c}} \\ \textcolor{#4287FF}{z_{c}} \\ w_{c} \\ \end{pmatrix} \ =\ \begin{pmatrix} \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 & \frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 \\ 0 & \frac { 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & 0 \\ 0 & 0 & \textcolor{#4287FF}{A} & B \\ 0 & 0 & -1 & 0 \\ \end{pmatrix} \begin{pmatrix} \textcolor{#FF3333}{x_{e}} \\ \textcolor{#4D9900}{y_{e}} \\ \textcolor{#4287FF}{z_{e}} \\ w_{e} \\ \end{pmatrix}
    $$
	$$
	    \textcolor{#4287FF}{z_n} \ =\ \frac{ \textcolor{#4287FF}{z_c} }{ w_c } \ =\ \frac{ \textcolor{#4287FF}{A} \cdot \textcolor{#4287FF}{z_e} + B \cdot w_e }{ \textcolor{#4287FF}{-z_e} }
	$$
    Из-за того, что в Координатах Наблюдателя по всем осям значение компоненты $w = 1$﻿, следовательно:
    $$\textcolor{#4287FF}{z_n} =\ \frac{ \textcolor{#4287FF}{A} \cdot \textcolor{#4287FF}{z_e} + B }{ \textcolor{#4287FF}{-z_e} }$$
    Тут основной принцип примерно такое же, как и примененый ранее $( \textcolor{#4287FF}{z_e}, \textcolor{#4287FF}{z_n} ) \rightarrow ( \textcolor{#4287FF}{-n}, \textcolor{#4287FF}{-1} )$﻿ и одновременно $( \textcolor{#4287FF}{z_e}, \textcolor{#4287FF}{z_n} ) \rightarrow ( \textcolor{#4287FF}{-f}, \textcolor{#4287FF}{1} )$﻿, так как сразу два этих условия должны выполняться, объединяем их в систему:
    
    $$
    \begin{cases} \frac{ \textcolor{#4287FF}{-A} \cdot \textcolor{#4287FF}{n} + B }{ \textcolor{#4287FF}{n} } \ =\ \textcolor{#4287FF}{-1} \\ \frac{ \textcolor{#4287FF}{-A} \cdot \textcolor{#4287FF}{f} + B }{ \textcolor{#4287FF}{f} } \ =\ \textcolor{#4287FF}{1} \end{cases}
    $$
    $$
    \begin{cases} \textcolor{#4287FF}{-A} \cdot \textcolor{#4287FF}{n} + B \ =\ \textcolor{#4287FF}{-n} \\ \textcolor{#4287FF}{-A} \cdot \textcolor{#4287FF}{f} + B \ =\ \textcolor{#4287FF}{f} \end{cases}
    $$
    Для решения данной системы уравнение для $\textcolor{#4287FF}{A}$﻿ и $B$﻿ - выразим первое уравнение через $B$﻿.
    $$
    B \ =\ \textcolor{#4287FF}{A} \cdot \textcolor{#4287FF}{n} \textcolor{#4287FF}{-n}
    $$
    Подставим данной выражение во второе уравнение системы:
    
    $$
    \textcolor{#4287FF}{-A} \cdot \textcolor{#4287FF}{f} \ +\ ( \textcolor{#4287FF}{A} \cdot \textcolor{#4287FF}{n} \textcolor{#4287FF}{-n} ) \ =\ \textcolor{#4287FF}{f}
    $$
    $$
    -( \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} ) \cdot \textcolor{#4287FF}{A} \textcolor{#4287FF}{-n} \ =\ \textcolor{#4287FF}{f}
    $$
    $$-( \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} ) \cdot \textcolor{#4287FF}{A} \ =\ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n}
    $$
    $$
    \textcolor{#4287FF}{A} \ =\ - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ ( \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} ) }
    $$
    Мы получили ответ - чему равно $\textcolor{#4287FF}{A}$﻿ теперь подставим этот ответ в тождество $B$﻿:
    
    $$B \ =\ - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ ( \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} ) } \cdot \textcolor{#4287FF}{n} \textcolor{#4287FF}{-n}$$
    $$B \ =\ - \Bigg( 1 + \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \Bigg) \cdot \textcolor{#4287FF}{n}$$
    $$B \ =\ - \Bigg( \frac{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} + \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \Bigg) \cdot \textcolor{#4287FF}{n}$$
    $$B \ =\ - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} }$$
    Мы нашли $\textcolor{#4287FF}{A}$﻿ и $B$﻿, теперь подставим их в исходное уравнение, что бы точно проследить отношения:
    $$
    \begin{equation} \textcolor{#4287FF}{z_n} =\ \frac{ - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ ( \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} ) }\cdot \textcolor{#4287FF}{z_e} - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } }{ \textcolor{#4287FF}{-z_e} } \end{equation}
    $$
    И наконец-то получим полностью готовую нашу _Матрицу Проекции_:
    $$
    \begin{pmatrix} \textcolor{#FF3333}{x_{c}} \\ \textcolor{#4D9900}{y_{c}} \\ \textcolor{#4287FF}{z_{c}} \\ w_{c} \\ \end{pmatrix} \ =\ \begin{pmatrix} \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 & \frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 \\ 0 & \frac { 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & 0 \\ 0 & 0 & - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } & - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \\ 0 & 0 & -1 & 0 \\ \end{pmatrix} \begin{pmatrix} \textcolor{#FF3333}{x_{e}} \\ \textcolor{#4D9900}{y_{e}} \\ \textcolor{#4287FF}{z_{e}} \\ w_{e} \\ \end{pmatrix}
    $$
    
    $$
    M_{projection} \ =\ \begin{pmatrix} \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 & \frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 \\ 0 & \frac { 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & 0 \\ 0 & 0 & - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } & - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \\ 0 & 0 & -1 & 0 \\ \end{pmatrix}
    $$
### Кейс, когда Усеченная Пирамида симметричная:
Матрицу, которую мы нашли выше можно будет сократить, при условии, что мы работаем с симметричной Усеченной Пирамидой. Симметрия _Усеченной Пирамиды_ задается следующим правилом: $\textcolor{\#FF3333}{r}\ =\ - \textcolor{#FF3333}{l}$﻿ и $\textcolor{\#4D9900}{t}\ =\ - \textcolor{#4D9900}{b}$﻿, то мы возьмем основные кейсы, где используются данные компоненты и составим систему уравнений:
$$
\begin{cases} \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} \ =\ 0 \\ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} \ =\ 2 \cdot \textcolor{#FF3333}{r} \ \ \text{ (Высота)} \end{cases} ,\ \ \begin{cases} \textcolor{#4D9900}{t}\ + \textcolor{#4D9900}{b} \ =\ 0 \\ \textcolor{#4D9900}{t}\ -\textcolor{#4D9900}{b} \ =\ 2 \cdot \textcolor{#4D9900}{t} \ \ \text{ (Ширина) } \end{cases}
$$
И после сокращений, с учетом вышеописанных систем координат, результирующая _Матрица Проекции_ будет иметь вид:
$$
M_{projection} \ =\ \begin{pmatrix} \frac { \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} } & 0 & 0 & 0 \\ 0 & \frac{ \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} } & 0 & 0 \\ 0 & 0 & - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } & - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \\ 0 & 0 & -1 & 0 \\ \end{pmatrix}
$$
### Проблема точности определения Глубины
Еще раз внимательно посмотрим на отношения между $\textcolor{#4287FF}{z_e}$﻿ и $\textcolor{#4287FF}{z_n}$﻿ (уравнение 3). Само уравнение представляет собой рациональную функцию, а значит отношения между $\textcolor{#4287FF}{z_e}$﻿ и $\textcolor{#4287FF}{z_n}$﻿ нелинейны. Нелинейность говорит о том, что чем ближе точка будет находится к ближней плоскости _Усеченноq Пирамиды_ ($\textcolor{#4287FF}{n}ear$﻿), тем выше будет точность, но эта же точность будет падать все больше и больше при достижении дальней плоскости ($\textcolor{#4287FF}{f}ar$﻿).

Если диапазон $[\textcolor{#4287FF}{-n}, \textcolor{#4287FF}{-f}]$﻿ расширяется - возникает такая проблема, как Глубинная Проблема Точности (_z-fighting_). Небольшие изменения по $\textcolor{#4287FF}{z_e}$﻿ рядом с дальней плоскостью ($\textcolor{#4287FF}{f}ar$﻿) не сильно аффектят значение $\textcolor{#4287FF}{z_n}$﻿.

Совет по избежанию этой проблемы - расстояние между $\textcolor{#4287FF}{-n}$﻿ и $\textcolor{#4287FF}{-f}$﻿ должно быть коротким насколько, насколько это возможно, что бы минимизировать у глубинного буфера проблемы с точностью.

![[z_fighting_narrow.svg]]

Вариант, когда расстояние между $\textcolor{#4287FF}{-n}$﻿ и $\textcolor{#4287FF}{-f}$﻿ - мало

![[z_fighting_wide.svg]]

Вариант, когда расстояние между $\textcolor{#4287FF}{-n}$﻿ и $\textcolor{#4287FF}{-f}$﻿ - велико. Цветом выделено налажение координат.
## Бесконечная Матрица Перспективы:

_Матрица Проекции Перспективы_ может быть упрощена, если предположить что дальняя плоскость Усеченной Пирамиды стремится в $\infty$﻿ в третьем ряду _Матрицы_.
$$
\begin{cases} \lim_{x\to\infty} - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } = -1\\ \lim_{x\to\infty} - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } = -2 \cdot \textcolor{#4287FF}{n}\\ \end{cases}
$$
И после подстановки, матрица примет вид:
$$
M_{projection} \ =\ \begin{pmatrix} \frac{ 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 & \frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 \\ 0 & \frac { 2\cdot \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & \frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & 0 \\ 0 & 0 & -1 & - 2 \cdot \textcolor{#4287FF}{n} \\ 0 & 0 & -1 & 0 \\ \end{pmatrix}
$$
В свою очередь Симметричная Бесконечная Матрица Проекции будет выглядеть так:
$$
M_{projection} \ =\ \begin{pmatrix} \frac { \textcolor{#4287FF}{n} }{ \textcolor{#FF3333}{r} } & 0 & 0 & 0 \\ 0 & \frac{ \textcolor{#4287FF}{n} }{ \textcolor{#4D9900}{t} } & 0 & 0 \\ 0 & 0 & -1 & - 2 \cdot \textcolor{#4287FF}{n} \\ 0 & 0 & -1 & 0 \\ \end{pmatrix}
$$
Но стоит помнить, что от проблемы точности определения Глубины - это не спасает.

## Матрица Перспективы с Полем Обзора (_Field of View - FOW_)

Довольно тяжело задать в коде сразу 4 параметра $(\textcolor{#ff3333}{l},\textcolor{#ff3333}{r}, \textcolor{#4D9900}{b},\textcolor{#4D9900}{t})$﻿ для ближней плоскости ($\textcolor{#4287FF}{n}ear$﻿) и для дальней плоскости _Усеченной Пирамиды_ ($\textcolor{#4287FF}{f}ar$﻿) , нужной для _Проекции Перспективы_ на специфическое _Окнонное Измерение_ (_window dimension_).

Но эти 4 параметра легко определяются через углы обзора и соотношения сторон, ширины/высоты при просмотре в 2-х мерной плоскости (вертикальные/горизонтальные).

К сожалению, данный подхлд будет работать только для _Симметричной Матрицы Перспективы_.
### Использование вертикального Поля Обзора
  

![[vertical_fov.svg]]

Если угол обзора ($\theta$﻿) вертикальный и известна ширина и высота экрана, параметры $(\textcolor{#ff3333}{l},\textcolor{#ff3333}{r}, \textcolor{#4D9900}{b},\textcolor{#4D9900}{t})$﻿ можно вычислить через отношения в прямоугольном треугольнике.  
Сначала вычислим полу-высоту $\textcolor{#4D9900}{top}$ используя тангенс полу-угла вертикального Поля Обзора:
$$
\frac{ \textcolor{#4D9900}{top} }{ \textcolor{#4287FF}{near} } \ =\ tan( \frac{ \theta }{ 2 } )
$$
$$
\textcolor{#4D9900}{top} \ =\ tan( \frac{ \theta }{ 2 } ) \cdot \textcolor{#4287FF}{near}
$$
При вертикальном угле обзора так же можно выразить и $\textcolor{#ff3333}{l}$﻿ и $\textcolor{#ff3333}{r}$﻿, не забываем, что Усеченная пирамида у нас симмертрична, а значит компоненты $|\textcolor{#ff3333}{l}|\ =\ |\textcolor{#ff3333}{r}|$﻿. Выразим $\textcolor{#ff3333}{r}$﻿ через соотношение $\frac{width}{height}$﻿, получим:
$$
\frac{width}{height} \ =\ \frac{2 \cdot \textcolor{#4D9900}{top}}{2 \cdot \textcolor{#ff3333}{right}} \ =\ \frac{\textcolor{#4D9900}{top}}{\textcolor{#ff3333}{right}}
$$
$$
\therefore \textcolor{#ff3333}{right} \ =\ \textcolor{#4D9900}{top}\ \cdot\ \frac{width}{height}
$$

А значит Матрицу Проекции можно будет выразить вот так:

$$
M_{projection} \ =\ \begin{pmatrix} \frac { height }{ weight\ \cdot\ tan(\frac{\theta}{2}) } & 0 & 0 & 0 \\ 0 & \frac{ 1 }{ tan(\frac{\theta}{2}) } & 0 & 0 \\ 0 & 0 & - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } & - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \\ 0 & 0 & -1 & 0 \\ \end{pmatrix}
$$

Учитывая, что можно запросить у пользователя сразу задавать $\frac{width}{height}$﻿ единым аргументом, выходит что в функцию в итоге и надо передать только 4 параметра - $\frac{width}{height}$﻿, $tan(\frac{\theta}{2})$﻿, $\textcolor{\#4287FF}{n}$﻿, $\textcolor{#4287FF}{f}$﻿.

### Использование горизонтального Поля Обзора

![[horizontal_fov.svg]]

Сначала вычислим полу-ширину ($\textcolor{#FF3333}{right}$﻿) используя тангенс полу-угла горизонтального _Поля Обзора_:

$$
\frac{ \textcolor{#ff3333}{right} }{ \textcolor{#4287FF}{near} } \ =\ tan(\frac{\phi}{2})
$$

$$
\textcolor{#ff3333}{right} \ =\ tan(\frac{\phi}{2}) \cdot \textcolor{#4287FF}{near}
$$
При горизонтальном угле обзора так же можно выразить и $\textcolor{#4D9900}{b}$﻿ и $\textcolor{#4D9900}{t}$﻿, не забываем, что Усеченная пирамида у нас симмертрична, а значит компоненты $|\textcolor{#4D9900}{b}|\ =\ |\textcolor{#4D9900}{t}|$﻿. Выразим $\textcolor{#4D9900}{t}$﻿ через соотношение $\frac{height}{width}$﻿, получим:

$$
\frac{height}{width} \ =\ \frac{2 \cdot \textcolor{#ff3333}{right} }{ 2 \cdot \textcolor{#4D9900}{top} } \ =\ \frac{\textcolor{#ff3333}{right}}{\textcolor{#4D9900}{top}}
$$

$$
\therefore \textcolor{#4D9900}{top} \ =\ \textcolor{#ff3333}{right}\ \cdot\ \frac{height}{width}
$$
А значит Матрицу Проекции можно будет выразить вот так:

$$
M_{projection} \ =\ \begin{pmatrix} \frac{ 1 }{ tan(\frac{\theta}{2}) } & 0 & 0 & 0 \\ 0 & \frac { weight }{ height\ \cdot\ tan(\frac{\theta}{2}) } & 0 & 0 \\ 0 & 0 & - \frac{ \textcolor{#4287FF}{f} \ +\ \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } & - \frac{ 2 \cdot \textcolor{#4287FF}{f} \cdot \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \\ 0 & 0 & -1 & 0 \\ \end{pmatrix}
$$
## Ортографическая проекция

![[orthographic_frustrum_and_ndc.svg]]

Ортографический Кубоид и Нормальные Координаты Устройства

Создание ортографической проекции происходит гораздо проще, нежели перспективной.

Все компоненты $\textcolor{#FF3333}{x_e}$﻿, $\textcolor{#4D9900}{y_e}$﻿ и $\textcolor{#4287FF}{z_e}$﻿ в Координатах Наблюдателя линейно проецируются на NDC, нам просто, по факту, надо отмапить Кубоид на Куб.  
Как и ранее в пункте про линейное отображение координат﻿ $\textcolor{#ff3333}{x_e}$, $\textcolor{#4D9900}{y_e}​$, ﻿ для Перспективной Проекции - будем использовать все те же принципы. Только в Ортографической проекции еще добавится координата $\textcolor{#4287FF}{z_e}​$.

Мы сейчас должны отобразить $\textcolor{#FF3333}{x_n}$﻿, $\textcolor{#4D9900}{y_n}$﻿, $\textcolor{#4287FF}{z_n}$﻿ на $\textcolor{#FF3333}{x_e}$﻿ и $\textcolor{#4D9900}{y_e}$﻿ и $\textcolor{#4287FF}{z_e}$﻿ в координатах _NDC_. В этом нам поможет линейная зависимость: $[\textcolor{\#ff3333}{l},\textcolor{#ff3333}{r}]$﻿ к $[\textcolor{#ff3333}{-1},\textcolor{#ff3333}{1}]$﻿, $[\textcolor{#4D9900}{b},\textcolor{#4D9900}{t}]$﻿ к $[\textcolor{#4D9900}{-1},\textcolor{#4D9900}{1}]$﻿ и $[\textcolor{#4287FF}{-n}, \textcolor{#4287FF}{-f}]$﻿ к $[\textcolor{#4287FF}{-1}, \textcolor{#4287FF}{1}]$﻿ (см. картинку в начале параграфа).

1. $[\textcolor{\#ff3333}{l},\textcolor{#ff3333}{r}]$﻿ к $[\textcolor{#ff3333}{-1},\textcolor{#ff3333}{1}]$﻿
    
    ![[mapping_xe_to_xn.svg]]
    
    Проецирование точки $\textcolor{#FF3333}{x_e}$﻿ на $\textcolor{#FF3333}{x_n}$﻿.
    Для того что бы понять куда будет происходить проецирование, вспомним самую базовую формулу из Алгебры - формулу линейной зависимости 2-х точек:
    $$\textcolor{#4D9900}{y} \ =\ m \cdot \textcolor{#FF3333}{x}\ +\ \beta$$
    Где $\beta$﻿ - координата пересечения ($x = 0$﻿) с осью $\textcolor{#4D9900}{y}$﻿, при линейной зависимости пересечение может случиться лишь раз.
    
    И $m$﻿ - угол наклона (slope), который показывает насколько сильно прямая наклонена относительно $\textcolor{#FF3333}{x}$﻿. Угол наклона высчитывается так:
    $$
    \text{m} \ =\ \dfrac{\text{изменение по }\textcolor{#4D9900}{y}}{\text{изменение по }\textcolor{#FF3333}{x}} \ =\ \dfrac{\textcolor{#4D9900}{y_2}-\textcolor{#4D9900}{y_1}}{\textcolor{#FF3333}{x_2}-\textcolor{#FF3333}{x_1}}
    $$
    Перепишем нашу проекцию от точки $\textcolor{#FF3333}{x_p}$﻿ на $\textcolor{#FF3333}{x_n}$﻿ как линейную зависимость:
    $$
    \begin{equation} \textcolor{#FF3333}{x_n} \ =\ \frac{\textcolor{#FF3333}{1} - (-\textcolor{#FF3333}{1})}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#FF3333}{x_e}\ +\ \beta \end{equation}
    $$
    Произведем замену точки $(\textcolor{#FF3333}{x_e}, \textcolor{#FF3333}{x_n})$﻿ на конкретную точку $(\textcolor{#FF3333}{r}, \textcolor{#FF3333}{1})$﻿ для дальнейшего выражения $\beta$﻿.
    $$
    \textcolor{#FF3333}{1} \ =\ \frac{\textcolor{#FF3333}{1} - (-\textcolor{#FF3333}{1})}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#FF3333}{r}\ +\ \beta
    $$
    Выразим $\beta$﻿:
	$$
	      
	\beta \ =\ \textcolor{#FF3333}{1} -\frac{\textcolor{#FF3333}{1} - (-\textcolor{#FF3333}{1})}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \cdot \textcolor{#FF3333}{r} \ =\ 
	$$
	$$
	\ =\  
	\textcolor{#FF3333}{1} - \frac{2 \cdot \textcolor{#FF3333}{r}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ = \frac{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} - \frac{2 \cdot \textcolor{#FF3333}{r}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ =\
	$$
	$$
	\ =\ 
	\frac{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} - 2 \cdot \textcolor{#FF3333}{r}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ =\ \frac{-\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ = \
	$$       $$
	\ =\ 
	- \frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}
	$$
    Результат выражения: $\beta = \frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}$﻿ подставим в уравнение $(4)$﻿.
	$$
	\therefore \textcolor{#FF3333}{x_n} \ =\ \frac{2\cdot \textcolor{#FF3333}{x_e}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}} \ -\ \frac{\textcolor{#FF3333}{r} + \textcolor{#FF3333}{l}}{\textcolor{#FF3333}{r} - \textcolor{#FF3333}{l}}
	$$
2. $[\textcolor{\#4D9900}{b},\textcolor{#4D9900}{t}]$﻿ к $[\textcolor{#4D9900}{-1},\textcolor{#4D9900}{1}]$﻿
	![[mapping_ye_to_yn.svg]]
    
	Проецирование точки $\textcolor{#4D9900}{y_e}$﻿ на $\textcolor{#4D9900}{y_n}$﻿.
    
	Перепишем нашу проекцию от точки $\textcolor{#4D9900}{y_e}$﻿ на $\textcolor{#4D9900}{y_n}$﻿как линейную зависимость: 
	$$
	\begin{equation} \textcolor{#4D9900}{y_n} \ =\ \frac{\textcolor{#4D9900}{1} - (-\textcolor{#4D9900}{1})}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \cdot \textcolor{#4D9900}{y_e}\ +\ \beta \end{equation}
	$$
	Произведем замену точки $(\textcolor{#4D9900}{y_e}, \textcolor{#4D9900}{y_n})$﻿ на конкретную точку $(\textcolor{#4D9900}{t}, \textcolor{#4D9900}{1})$﻿ для дальнейшего выражения $\beta$﻿.
	$$
	\textcolor{#4D9900}{1} \ =\ \frac{\textcolor{#4D9900}{1} - (-\textcolor{#4D9900}{1})}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \cdot \textcolor{#4D9900}{r}\ +\ \beta
	$$
	Выразим $\beta$﻿:    
   $$
\beta \ =\ \textcolor{#4D9900}{1} -\frac{\textcolor{#4D9900}{1} - (-\textcolor{#4D9900}{1})}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \cdot \textcolor{#4D9900}{t} \ =\newline \textcolor{#4D9900}{1} - \frac{2 \cdot \textcolor{#4D9900}{t}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ = 
\frac{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} - \frac{2 \cdot \textcolor{#4D9900}{t}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} 
\ =\newline 
$$$$
\frac{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} - 2 \cdot \textcolor{#4D9900}{t}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ =\ \frac{-\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}
$$$$ 
\ =\newline 
- \frac{\textcolor{#4D9900}{t} + \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}
   $$
	Результат выражения: $\beta = \frac{\textcolor{#4D9900}{t} + \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}$﻿ подставим в уравнение $(5)$﻿.
	  $$
	  \therefore \textcolor{#4D9900}{y_n} \ =\ \frac{2\cdot \textcolor{#4D9900}{y_e}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}} \ -\ \frac{\textcolor{#4D9900}{t} + \textcolor{#4D9900}{b}}{\textcolor{#4D9900}{t} - \textcolor{#4D9900}{b}}
	  $$
3. $[\textcolor{\#4287FF}{-n}, \textcolor{#4287FF}{-f}]$﻿ к $[\textcolor{#4287FF}{-1}, \textcolor{#4287FF}{1}]$﻿
    
    ![[mapping_ze_to_zn.svg]]
    
    Проецирование точки $\textcolor{#4287FF}{z_e}$﻿ на $\textcolor{#4287FF}{z_n}$﻿.
    
    Перепишем нашу проекцию от точки $\textcolor{#4287FF}{z_e}$﻿ на $\textcolor{#4287FF}{z_n}$﻿ как линейную зависимость:
    $$
    \begin{equation} \textcolor{#4287FF}{z_n} \ =\ \frac{\textcolor{#4287FF}{1} - (-\textcolor{#4287FF}{1})}{\textcolor{#4287FF}{-f} - (\textcolor{#4287FF}{-n})} \cdot \textcolor{#4287FF}{z_e}\ +\ \beta \end{equation}
    $$
    Произведем замену точки $(\textcolor{#4287FF}{z_e}, \textcolor{#4287FF}{z_n})$﻿ на конкретную точку $(\textcolor{#4287FF}{-f}, \textcolor{#4287FF}{1})$﻿ для дальнейшего выражения $\beta$﻿.
    $$
    \textcolor{#4287FF}{1} \ =\ \frac{2}{\textcolor{#4287FF}{-f} - (\textcolor{#4287FF}{-n})} \cdot (\textcolor{#4287FF}{-f})\ +\ \beta
	$$
	$$
    -\beta \ =\ -\frac{2 \cdot \textcolor{#4287FF}{f}}{\textcolor{#4287FF}{n} - \textcolor{#4287FF}{f}} \ -\ \textcolor{#4287FF}{1}
    $$
    $$
    \beta \ =\ \frac{2 \cdot \textcolor{#4287FF}{f}}{\textcolor{#4287FF}{n} - \textcolor{#4287FF}{f}} \ +\ \textcolor{#4287FF}{1}
    $$
    $$
    \beta \ =\ \textcolor{#4287FF}{1} \ -\ \frac{2 \cdot \textcolor{#4287FF}{f}}{\textcolor{#4287FF}{f} - \textcolor{#4287FF}{n}}
    $$
	$$
	\beta \ =\ \frac{ \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} } { \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} } \ -\ \frac{2 \cdot \textcolor{#4287FF}{f} }{ \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} } \ =\ \frac{\textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} - 2 \cdot \textcolor{#4287FF}{f} }{ \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} }
	$$
	$$
	\beta \ =\ \frac{ -\textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} } \ =\ -\frac{ \textcolor{#4287FF}{f} + \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} }
	$$
    Результат выражения: $\beta = -\frac{ \textcolor{#4287FF}{f} + \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} }$﻿ подставим в уравнение ﻿$(6)$.
    $$
    \therefore \textcolor{#4287FF}{z_n} \ =\ \frac{\textcolor{#4287FF}{-2}}{\textcolor{#4287FF}{f} - \textcolor{#4287FF}{n}} \cdot \textcolor{#4287FF}{z_e} \ -\ \frac{ \textcolor{#4287FF}{f} + \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} - \textcolor{#4287FF}{n} }
    $$
    Так как компонента w не нужна в ортографической проекции 4-ый пяд в _Матрице Проекции_ будет $(0, 0, 0, 1)$﻿. А сама матрица будет выглядеть так:    
    $$
    M_{projection} \ =\ \begin{pmatrix} \frac{ 2 }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } & 0 & 0 & -\frac{ \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} }{ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} } \\ 0 & \frac { 2 }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } & 0 & -\frac{ \textcolor{#4D9900}{t} + \textcolor{#4D9900}{b} }{ \textcolor{#4D9900}{t} - \textcolor{#4D9900}{b} } \\ 0 & 0 & - \frac{ 2 }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } & - \frac{ \textcolor{#4287FF}{f} + \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \\ 0 & 0 & 0 & 1 \\ \end{pmatrix}
    $$
    Матрицу, которую мы нашли выше можно будет сократить, так как кубоид, по которому построена матрица, симметричен. Симметрия _Кубоида_ задается следующим правилом: $\textcolor{#FF3333}{r}\ =\ - \textcolor{#FF3333}{l}$﻿ и $\textcolor{#4D9900}{t}\ =\ - \textcolor{#4D9900}{b}$﻿, то мы возьмем основные кейсы, где используются данные компоненты и составим систему уравнений:
    $$
    \begin{cases} \textcolor{#FF3333}{r} + \textcolor{#FF3333}{l} \ =\ 0 \\ \textcolor{#FF3333}{r} - \textcolor{#FF3333}{l} \ =\ 2 \cdot \textcolor{#FF3333}{r} \ \ \text{ (Высота)} \end{cases} ,\ \ \begin{cases} \textcolor{#4D9900}{t}\ + \textcolor{#4D9900}{b} \ =\ 0 \\ \textcolor{#4D9900}{t}\ -\textcolor{#4D9900}{b} \ =\ 2 \cdot \textcolor{#4D9900}{t} \ \ \text{ (Ширина) } \end{cases}
    $$
    Подставив данную зависимость в _Матрицу Проекции_, получим:
    $$
    M_{projection} \ =\ \begin{pmatrix} \frac{ 1 }{ \textcolor{#FF3333}{r} } & 0 & 0 & 0 \\ 0 & \frac { 1 }{ \textcolor{#4D9900}{t} } & 0 & 0 \\ 0 & 0 & - \frac{ 2 }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } & - \frac{ \textcolor{#4287FF}{f} + \textcolor{#4287FF}{n} }{ \textcolor{#4287FF}{f} \ -\ \textcolor{#4287FF}{n} } \\ 0 & 0 & 0 & 1 \\ \end{pmatrix}
    $$
    